{{- define "titan-mesh-helm-lib-chart.envoy.matcher-headers" }}
  {{- if .headers }}
  headers:
  {{- end }}
  {{- range .headers }}
  - name: {{ .key }}
    {{- if or .eq .sw .ew .co .lk }}
      {{- if .eq }}
    string_match: 
      exact: {{ .eq | squote }}
      {{- else if .sw }}
    string_match: 
      prefix: {{ .sw | squote }}
      {{- else if .ew }}
    string_match: 
      suffix: {{ .ew | squote }}
      {{- else if .co }}
    string_match: 
      contains: {{ .co | squote }}
      {{- else if .lk }}
    string_match: 
      safe_regex:
        google_re2: {}
        regex: {{ .lk | squote }}
      {{- end }}
    {{- else if or .neq .nsw .new .nco .nlk }}
      {{- if .neq }}
    string_match: 
      exact: {{ .neq | squote }}
      {{- else if .nsw }}
    string_match: 
      prefix: {{ .nsw | squote }}
      {{- else if .new }}
    string_match: 
      suffix: {{ .new | squote }}
      {{- else if .nco }}
    string_match: 
      contains: {{ .nco | squote }}
      {{- else if .nlk }}
    string_match: 
      safe_regex:
        google_re2: {}
        regex: {{ .nlk | squote }}
      {{- end }}
    invert_match: true
    {{- else if .pr }}
      {{- if hasPrefix "x-tint-" .key }}
    string_match:
      exact: "nil"
    invert_match: true
      {{- else }}
    present_match: true
      {{- end }}
    {{- else if .npr }}
      {{- if hasPrefix "x-tint-" .key }}
    string_match:
      exact: "nil"
      {{- else }}
    present_match: true
    invert_match: true
      {{- end }}
    {{- else }}
      {{- fail "invalid header match definition - oneof operators [eq, neq, co, nco, sw, nsw, ew, new, lk, nlk, pr, npr] is required" }}
    {{- end }}
  {{- end }}
{{- end }}